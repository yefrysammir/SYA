<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Lock Numérico</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json"/>
<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<!-- Fuentes -->
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@300" rel="stylesheet"/>

<style>
:root {
  --primary: #ffa0e5;
  --text: #ffffff;
}

/* --- Global --- */
*{margin:0;padding:0;box-sizing:border-box;-webkit-user-select:none;user-select:none;}
html,body{
  width:100%;height:100dvh;min-height:100vh;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  color:var(--text);
  overflow:hidden;
  background:#000;
}

/* --- Lock Screen --- */
#lockScreen{
  position:fixed;inset:0;
  display:flex;flex-direction:column;
  justify-content:center;align-items:center;
  background:url("momentos/foto0.jpg") no-repeat center/cover;
  transition:transform 0.7s ease-in-out;
  z-index:10;
}
#lockScreen::after{
  content:"";
  position:absolute;inset:0;
  background:rgba(0,0,0,0.35);
  pointer-events:none;
}
.lockContent{
  position:relative;
  display:flex;flex-direction:column;
  align-items:center;
  z-index:1;
  width:100%;
  padding-top:env(safe-area-inset-top);
  padding-bottom:env(safe-area-inset-bottom);
}

/* Corazón animado */
.heart{
  font-size:3rem;
  margin-bottom:1rem;
  animation:heartbeat 1.8s infinite;
}
@keyframes heartbeat{0%,100%{transform:scale(1);}50%{transform:scale(1.2);}}

/* PIN dots */
#pinDots{display:flex;gap:.5rem;margin-bottom:1rem;}
.dot{
  width:.9rem;height:.9rem;border-radius:50%;
  border:2px solid var(--text);
  background:transparent;
  transition:.2s;
}
.dot.filled{background:var(--text);}

/* Mensaje */
#message{
  font-size:1.1rem;
  margin-bottom:1rem;
  min-height:1.5rem;
  opacity:0;
  transition:opacity .3s ease;
}
#message.show{opacity:1;}
.shake{animation:shake .4s;}
@keyframes shake{
  0%,100%{transform:translateX(0);}
  20%,60%{transform:translateX(-8px);}
  40%,80%{transform:translateX(8px);}
}

/* Keypad */
#keypad{
  display:grid;
  grid-template-columns:repeat(3,min(20vw,70px));
  gap:1rem;
  justify-content:center;
}
.key{
  width:min(20vw,70px);height:min(20vw,70px);
  border-radius:50%;
  background:rgba(0,0,0,0.4);
  color:var(--text);
  display:flex;align-items:center;justify-content:center;
  font-size:2rem;
  cursor:pointer;
  backdrop-filter:blur(6px);
  transition:.2s;
  position:relative;
  overflow:hidden;
}
.key:active{transform:scale(0.9);}
.key::after{
  content:"";
  position:absolute;
  width:120%;height:120%;
  top:50%;left:50%;
  background:rgba(255,255,255,0.2);
  border-radius:50%;
  transform:translate(-50%,-50%) scale(0);
  transition:transform 0.4s, opacity 0.4s;
  opacity:0;
}
.key:active::after{
  transform:translate(-50%,-50%) scale(1);
  opacity:1;
}
.material-symbols-outlined{font-size:2rem;}

/* --- Stories --- */
#stories{
  position:fixed;inset:0;
  background:#000;
  overflow-y:auto;
  scroll-snap-type:y mandatory;
  transform:translateY(100%);
  transition:transform 0.7s ease-in-out;
  z-index:5;
}
.story{
  min-height:100dvh;
  width:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  scroll-snap-align:start;
  padding:2rem;
  background-size:cover;
  background-position:center;
  position:relative;
}
.story::after{
  content:"";
  position:absolute;inset:0;
  background:rgba(0,0,0,0.4);
}
.storyContent{
  position:relative;
  z-index:1;
}
.story h2{
  font-family:"Dancing Script", cursive;
  font-size:2rem;
  margin-bottom:.5rem;
}
.story .date{
  font-size:1rem;
  opacity:0.8;
  margin-bottom:1rem;
}
.story p{
  font-size:1.1rem;
  line-height:1.4;
}
</style>
</head>
<body oncontextmenu="return false;">

<!-- Lock -->
<div id="lockScreen">
  <div class="lockContent">
    <span class="material-symbols-outlined heart">favorite</span>
    <div id="message" class="show">Ingrese código</div>
    <div id="pinDots"></div>
    <div id="keypad"></div>
  </div>
</div>

<!-- Stories -->
<div id="stories">
  <section class="story" style="background-image:url('momentos/foto1.jpg')">
    <div class="storyContent">
      <h2>Una nueva historia</h2>
      <div class="date">21 de agosto del 2025</div>
      <p>Decididos a iniciar una increíble historia llena de retos, momentos, sentimientos y ganas de tener una casita propia juntos.</p>
    </div>
  </section>
  <section class="story" style="background-image:url('momentos/foto2.jpg')">
    <div class="storyContent">
      <h2>Momento especial</h2>
      <div class="date">10 de septiembre del 2025</div>
      <p>Aquel día que reímos hasta que nos dolió la barriga y prometimos nunca soltarnos.</p>
    </div>
  </section>
  <section class="story" style="background-image:url('momentos/foto3.jpg')">
    <div class="storyContent">
      <h2>Nuestro sueño</h2>
      <div class="date">14 de febrero del 2026</div>
      <p>Un día de amor, planes de futuro y la ilusión de seguir construyendo juntos.</p>
    </div>
  </section>
</div>

<script>
// --- Configuración ---
const PASSWORD_HASH = "4908ef154f13f297da224aceaa78fbbedfc12adf625611d8972b148c43c9e46d"; 
const PIN_LENGTH = 6;

// --- Bloqueos ---
let attempts = parseInt(localStorage.getItem("attempts")||"0");
let blockLevel = parseInt(localStorage.getItem("blockLevel")||"0");
let blockedUntil = parseInt(localStorage.getItem("blockedUntil")||"0");
const blockTimes = [15*60*1000,30*60*1000,60*60*1000,24*60*60*1000];
const maxBlock = 30*24*60*60*1000;

// --- Helpers ---
async function hashPassword(pwd){
  const enc=new TextEncoder().encode(pwd);
  const buf=await crypto.subtle.digest("SHA-256",enc);
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,"0")).join("");
}
function now(){return Date.now();}

// --- Dots ---
const dots=document.getElementById("pinDots");
for(let i=0;i<PIN_LENGTH;i++){
  const d=document.createElement("div");
  d.className="dot";
  dots.appendChild(d);
}
const dotEls=[...document.querySelectorAll(".dot")];
const msg=document.getElementById("message");
const lockScreen=document.getElementById("lockScreen");
const stories=document.getElementById("stories");

// --- Keypad ---
const keypad=document.getElementById("keypad");
function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}return arr;}
function renderKeypad(){
  keypad.innerHTML="";
  let nums=shuffle([...Array(10).keys()]);
  nums.forEach(n=>{
    const k=document.createElement("div");
    k.className="key";
    k.textContent=n;
    k.onclick=()=>enterDigit(n);
    keypad.appendChild(k);
  });
  const del=document.createElement("div");
  del.className="key material-symbols-outlined";
  del.textContent="backspace";
  del.onclick=deleteDigit;
  keypad.appendChild(del);
  const ok=document.createElement("div");
  ok.className="key material-symbols-outlined";
  ok.textContent="check_circle";
  ok.onclick=checkPassword;
  keypad.appendChild(ok);
}
renderKeypad();

// --- Lógica ---
let input="";
function enterDigit(n){
  if(isBlocked())return;
  if(input.length>=PIN_LENGTH)return;
  input+=n;
  dotEls[input.length-1].classList.add("filled");
}
function deleteDigit(){
  if(input.length>0){
    dotEls[input.length-1].classList.remove("filled");
    input=input.slice(0,-1);
  }
}
function isBlocked(){
  if(now()<blockedUntil){
    const left=Math.ceil((blockedUntil-now())/1000/60);
    showMessage(`Bloqueado ${left} min`);
    return true;
  }
  return false;
}
function showMessage(text,shake=false){
  msg.classList.remove("show");
  setTimeout(()=>{
    msg.textContent=text;
    msg.classList.add("show");
    if(shake){
      msg.classList.add("shake");
      setTimeout(()=>msg.classList.remove("shake"),400);
    }
  },200);
}
async function checkPassword(){
  if(isBlocked())return;
  if(input.length!==PIN_LENGTH)return;
  const hash=await hashPassword(input);
  if(hash===PASSWORD_HASH){
    showMessage("✔ Desbloqueado!");
    localStorage.removeItem("attempts");
    localStorage.removeItem("blockLevel");
    localStorage.removeItem("blockedUntil");
    // animación desbloqueo
    lockScreen.style.transform="translateY(-100%)";
    stories.style.transform="translateY(0)";
  }else{
    attempts++;
    localStorage.setItem("attempts",attempts);
    showMessage("Código incorrecto",true);
    input="";
    dotEls.forEach(d=>d.classList.remove("filled"));
    renderKeypad();
    if(attempts>=4){
      attempts=0;
      blockLevel++;
      let blockTime=blockTimes[blockLevel-1]||maxBlock;
      blockedUntil=now()+blockTime;
      localStorage.setItem("attempts",attempts);
      localStorage.setItem("blockLevel",blockLevel);
      localStorage.setItem("blockedUntil",blockedUntil);
      isBlocked();
    }
  }
}

// --- PWA Service Worker ---
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js')
    .then(reg => console.log("SW registrado", reg))
    .catch(err => console.error("Error registrando SW", err));
}
</script>
</body>
</html>