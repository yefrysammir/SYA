<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" id="theme" content="#000000">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <title>Lock + Slides</title>
  <style>
    /* RESET */
    * {margin:0;padding:0;box-sizing:border-box;}
    body,html {
      width:100%;height:100%;
      overflow:hidden;
      font-family:sans-serif;
      background:#000;
      color:#fff;
    }

    /* ----- LOCK OVERLAY ----- */
    #lockOverlay {
      position:fixed;
      top:0;left:0;right:0;bottom:0;
      background:url('momentos/foto1.jpg') no-repeat center center/cover;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      z-index:9999;
    }
    #lockOverlay::after {
      content:"";
      position:absolute;
      top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,0.45);
    }
    #lockContent {
      position:relative;
      z-index:1;
      text-align:center;
    }
    .material-symbols-outlined {
      font-size:42px;
      color:white;
      margin-bottom:20px;
    }
    #message {
      margin-bottom:20px;
      font-size:18px;
    }
    #keypad {
      display:grid;
      grid-template-columns:repeat(3,70px);
      gap:15px;
      justify-content:center;
    }
    #keypad button {
      width:70px;height:70px;
      border-radius:50%;
      border:none;
      font-size:24px;
      font-weight:bold;
      background:rgba(255,255,255,0.15);
      color:#fff;
      backdrop-filter:blur(5px);
      transition:transform 0.1s;
    }
    #keypad button:active {transform:scale(0.9);}
    .shake {animation:shake 0.3s;}
    @keyframes shake {
      0%{transform:translateX(-8px);}
      25%{transform:translateX(8px);}
      50%{transform:translateX(-6px);}
      75%{transform:translateX(6px);}
      100%{transform:translateX(0);}
    }

    /* ----- SLIDER ----- */
    #slider {
      width:100%;height:100%;
      position:relative;
      overflow:hidden;
    }
    .slide {
      width:100%;height:100%;
      position:absolute;
      top:0;left:100%;
      display:flex;
      flex-direction:column;
      justify-content:flex-end;
      align-items:flex-start;
      padding:20px;
      background-size:cover;
      background-position:center;
      transition:left 0.5s;
    }
    .slide.active {left:0;}
    .content {
      background:rgba(0,0,0,0.4);
      padding:15px;
      border-radius:10px;
      max-width:90%;
    }
    .content h3 {margin-bottom:5px;font-size:20px;}
    .content .date {font-size:14px;opacity:0.8;margin-bottom:10px;}
    .content p {font-size:15px;}

    /* TOP BAR */
    .topBar {
      position:absolute;
      top:0;left:0;right:0;
      padding:10px;
      display:flex;
      align-items:center;
      background:rgba(0,0,0,0.3);
      backdrop-filter:blur(5px);
      z-index:100;
    }
    .topBar input {
      flex:1;
      margin:0 10px;
      padding:5px;
      border:none;
      border-radius:5px;
      display:none;
    }
    .topBar.active input {display:block;}
    .badge {
      background:red;
      padding:3px 8px;
      border-radius:12px;
      font-size:12px;
      margin-left:10px;
      display:none;
    }

    /* NAV BUTTONS */
    .nav-btn {
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      font-family:'Material Symbols Outlined';
      font-size:40px;
      color:white;
      background:rgba(0,0,0,0.4);
      padding:8px;
      border-radius:50%;
      cursor:pointer;
      z-index:200;
      user-select:none;
    }
    #leftArrow {left:10px;}
    #rightArrow {right:10px;}
  </style>
</head>
<body>

<!-- 🔒 LOCK SCREEN -->
<div id="lockOverlay">
  <div id="lockContent">
    <span class="material-symbols-outlined">favorite</span>
    <div id="message">Ingrese código</div>
    <div id="keypad"></div>
  </div>
</div>

<!-- 📸 SLIDER -->
<div id="slider">
  <div class="slide" data-title="Una nueva historia" data-desc="Decididos a iniciar..." data-date="2025-08-12" style="background-image:url('momentos/foto1.jpg')"></div>
  <div class="slide" data-title="Momento 2" data-desc="Descripción" data-date="2025-08-13" style="background-image:url('momentos/foto2.jpg')"></div>
  <div class="slide" data-title="Momento 3" data-desc="Descripción" data-date="2025-08-14" style="background-image:url('momentos/foto3.jpg')"></div>
  <!-- ... más slides ... -->
</div>

<div class="topBar" id="topBar">
  <span id="searchBtn" class="material-symbols-outlined">search</span>
  <input id="searchInput" type="number" inputmode="numeric" min="1">
  <span id="counter"></span>
  <span id="newBadge" class="badge">Nuevo</span>
</div>

<div id="leftArrow" class="nav-btn">chevron_left</div>
<div id="rightArrow" class="nav-btn">chevron_right</div>

<script>
/* -------- LOCK -------- */
const keypad = document.getElementById('keypad');
const message = document.getElementById('message');
let pin = "";
const correctPIN = "1234";
let attempts = 0;
let lockUntil = null;

function generateKeypad() {
  keypad.innerHTML="";
  const nums = Array.from({length:10},(_,i)=>i).sort(()=>Math.random()-0.5);
  nums.forEach(n=>{
    const btn=document.createElement('button');
    btn.textContent=n;
    btn.onclick=()=>enterDigit(n);
    keypad.appendChild(btn);
  });
}
function enterDigit(n) {
  if(lockUntil && Date.now()<lockUntil){
    message.textContent="Bloqueado, espera...";
    return;
  }
  pin+=n;
  if(pin.length===correctPIN.length){
    if(pin===correctPIN){
      document.getElementById('lockOverlay').style.display="none";
      initSlides();
    } else {
      attempts++;
      pin="";
      message.textContent="Código incorrecto";
      keypad.classList.add("shake");
      setTimeout(()=>keypad.classList.remove("shake"),300);
      if(attempts>=4){
        const times=[15,30,60,1440,43200];
        const t=times[Math.min(attempts-4,times.length-1)];
        lockUntil=Date.now()+t*60000;
        message.textContent=`Bloqueado por ${t>=1440?t/1440+" días":t+" minutos"}`;
      }
    }
  }
}
generateKeypad();

/* -------- SLIDES -------- */
function initSlides(){
  const slides=document.querySelectorAll('.slide'),
        counter=document.getElementById('counter'),
        searchBtn=document.getElementById('searchBtn'),
        searchIn=document.getElementById('searchInput'),
        topBar=document.getElementById('topBar');
  const months=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"];

  slides.forEach((s,i)=>{
    const d=new Date(s.dataset.date);
    const div=document.createElement('div');
    div.className="content";
    div.innerHTML=`<h3>${s.dataset.title}</h3>
    <div class="date">${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}</div>
    <p>${s.dataset.desc}</p>`;
    s.appendChild(div);
  });

  let current=0;
  slides[current].classList.add("active");
  counter.textContent=`1 / ${slides.length}`;

  document.getElementById('leftArrow').onclick=()=>changeSlide(-1);
  document.getElementById('rightArrow').onclick=()=>changeSlide(1);

  function changeSlide(dir){
    slides[current].classList.remove("active");
    current=(current+dir+slides.length)%slides.length;
    slides[current].classList.add("active");
    counter.textContent=`${current+1} / ${slides.length}`;
  }

  // buscador
  searchBtn.onclick=(e)=>{
    e.stopPropagation();
    topBar.classList.add('active');
    searchIn.focus();
  };
  searchIn.addEventListener('keypress',function(e){
    if(e.key==='Enter'){
      const n=parseInt(this.value);
      if(n>=1&&n<=slides.length){
        slides[current].classList.remove('active');
        current=n-1;
        slides[current].classList.add('active');
        counter.textContent=(current+1)+' / '+slides.length;
      }
      resetSearch();
    }
  });
  function resetSearch(){
    searchIn.value='';
    topBar.classList.remove('active');
  }

  // badge
  const b=document.getElementById('newBadge');
  const slidesSeen=parseInt(localStorage.getItem('slidesSeen')||'0');
  if(slides.length>slidesSeen){
    b.style.display='inline-block';
    setTimeout(()=>{
      b.style.animation="badgeShake 0.5s";
      setTimeout(()=>b.style.animation="",500);
    },3000);
    document.addEventListener('click',()=>{
      b.style.display='none';
      localStorage.setItem('slidesSeen',slides.length);
    },{once:true});
  }
}

if ('serviceWorker' in navigator) navigator.serviceWorker.register('service-worker.js');
</script>
</body>
</html>