<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no">
<title>Lock Numérico</title>

<link rel="manifest" href="manifest.json"/>
<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@300" rel="stylesheet"/>

<style>
:root {
  --primary: #ffa0e5;
  --text: #fff;
}

/* --- Global --- */
*{margin:0;padding:0;box-sizing:border-box;-webkit-user-select:none;user-select:none;}
html,body{
  width:100%;height:100dvh;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  color:var(--text);
  overflow:hidden;
  background:#000;
}

/* --- LockScreen --- */
#lockScreen{
  position:fixed;inset:0;
  display:flex;flex-direction:column;
  justify-content:center;align-items:center;
  background:url("momentos/foto0.jpg") no-repeat center/cover;
}
#lockScreen::after{
  content:"";position:absolute;inset:0;
  background:rgba(0,0,0,0.35);
}
.lockContent{position:relative;display:flex;flex-direction:column;align-items:center;z-index:1;width:100%;}

/* Corazón */
.heart{font-size:3rem;margin-bottom:1rem;animation:heartbeat 1.8s infinite;}
@keyframes heartbeat{0%,100%{transform:scale(1);}50%{transform:scale(1.2);}}

/* Indicador PIN */
#pinDots{display:flex;gap:.5rem;margin-bottom:1rem;}
.dot{width:.9rem;height:.9rem;border-radius:50%;border:2px solid var(--text);transition:.2s;}
.dot.filled{background:var(--text);}

/* Mensaje */
#message{font-size:1.1rem;margin-bottom:1rem;min-height:1.5rem;transition:.3s;}
.shake{animation:shake .4s;}
@keyframes shake{0%,100%{transform:translateX(0);}20%,60%{transform:translateX(-8px);}40%,80%{transform:translateX(8px);}}

/* Keypad */
#keypad{display:grid;grid-template-columns:repeat(3,70px);gap:1rem;justify-content:center;}
.key{
  width:70px;height:70px;border-radius:50%;
  background:rgba(0,0,0,0.4);color:var(--text);
  display:flex;align-items:center;justify-content:center;
  font-size:2rem;cursor:pointer;
  backdrop-filter:blur(6px);
  transition:.15s;
  touch-action:manipulation;
}
.key:active{transform:scale(0.9);}
.material-symbols-outlined{font-size:2rem;}

/* --- Slides --- */
#slidesWrapper{display:none;position:fixed;inset:0;overflow:hidden;}
.slide{
  width:100%;height:100%;
  flex-shrink:0;
  display:flex;flex-direction:column;
  justify-content:center;align-items:center;
  background:#000;color:#fff;
  padding:2rem;text-align:center;
  font-family:'Dancing Script',cursive;
  font-size:1.2rem;
}
.slide h2{font-size:2rem;margin-bottom:.5rem;}
.slide p{font-size:1rem;max-width:90%;}
.slide small{opacity:.7;margin-top:.5rem;}

/* Barra contador */
#topbar{
  position:fixed;top:0;left:0;width:100%;
  display:flex;align-items:center;justify-content:center;
  background:rgba(0,0,0,.5);backdrop-filter:blur(8px);
  padding:.5rem;z-index:10;
}
#slideCounter{
  width:100px;padding:.3rem .6rem;
  border-radius:20px;border:none;
  text-align:center;font-size:1rem;
  -webkit-appearance:none;
}
</style>
</head>
<body oncontextmenu="return false;">

<div id="lockScreen">
  <div class="lockContent">
    <span class="material-symbols-outlined heart">favorite</span>
    <div id="message">Ingrese código</div>
    <div id="pinDots"></div>
    <div id="keypad"></div>
  </div>
</div>

<div id="slidesWrapper">
  <div id="topbar">
    <input type="number" id="slideCounter" inputmode="numeric" pattern="[0-9]*">
  </div>
  <div id="slidesContainer" style="display:flex;flex-direction:column;height:100%;transition:transform .4s ease;"></div>
</div>

<script>
// --- Configuración ---
const PASSWORD_HASH="4908ef154f13f297da224aceaa78fbbedfc12adf625611d8972b148c43c9e46d";
const PIN_LENGTH=6;

// --- Dots ---
const dots=document.getElementById("pinDots");
for(let i=0;i<PIN_LENGTH;i++){dots.innerHTML+=`<div class="dot"></div>`;}
const dotEls=[...document.querySelectorAll(".dot")];
const msg=document.getElementById("message");

// --- Keypad ---
const keypad=document.getElementById("keypad");
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
function renderKeypad(){
  keypad.innerHTML="";
  shuffle([...Array(10).keys()]).forEach(n=>{
    const k=document.createElement("div");
    k.className="key";k.textContent=n;
    k.addEventListener("touchstart",()=>enterDigit(n));
    k.addEventListener("click",()=>enterDigit(n));
    keypad.appendChild(k);
  });
  const del=document.createElement("div");
  del.className="key material-symbols-outlined";del.textContent="backspace";
  del.addEventListener("touchstart",deleteDigit);
  del.addEventListener("click",deleteDigit);
  keypad.appendChild(del);
}
renderKeypad();

// --- Lógica Lock ---
let input="";
async function hashPassword(pwd){
  const enc=new TextEncoder().encode(pwd);
  const buf=await crypto.subtle.digest("SHA-256",enc);
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,"0")).join("");
}
function enterDigit(n){
  if(input.length>=PIN_LENGTH)return;
  input+=n;dotEls[input.length-1].classList.add("filled");
  if(input.length===PIN_LENGTH) checkPassword();
}
function deleteDigit(){
  if(input.length>0){
    dotEls[input.length-1].classList.remove("filled");
    input=input.slice(0,-1);
  }
}
async function checkPassword(){
  const hash=await hashPassword(input);
  if(hash===PASSWORD_HASH){unlock();}
  else{
    msg.textContent="Código incorrecto";msg.classList.add("shake");
    setTimeout(()=>msg.classList.remove("shake"),400);
    input="";dotEls.forEach(d=>d.classList.remove("filled"));renderKeypad();
  }
}
function unlock(){
  document.getElementById("lockScreen").style.display="none";
  document.getElementById("slidesWrapper").style.display="block";
  initSlides();
}

// --- Slides JSON ---
const slidesData=[
  {title:"Una nueva historia",date:"21 de agosto del 2025",desc:"Decididos a iniciar una increíble historia llena de retos, momentos y sentimientos."},
  {title:"Momento especial",date:"22 de agosto del 2025",desc:"Un día para recordar juntos y sonreír."},
  {title:"Nuestro futuro",date:"23 de agosto del 2025",desc:"Soñando con la casita propia, construyendo nuestro hogar."}
];

let currentIndex=0;
const slidesContainer=document.getElementById("slidesContainer");
function initSlides(){
  slidesData.forEach(s=>{
    const el=document.createElement("div");
    el.className="slide";
    el.innerHTML=`<h2>${s.title}</h2><small>${s.date}</small><p>${s.desc}</p>`;
    slidesContainer.appendChild(el);
  });
  updateCounter();
}

// --- Navegación touch con loop ---
let startY=0;
slidesContainer.addEventListener("touchstart",e=>startY=e.touches[0].clientY);
slidesContainer.addEventListener("touchend",e=>{
  let diff=startY-e.changedTouches[0].clientY;
  if(Math.abs(diff)>40){
    if(diff>0) nextSlide(); else prevSlide();
  }
});
function nextSlide(){
  currentIndex=(currentIndex+1)%slidesData.length;
  updateTransform();
}
function prevSlide(){
  currentIndex=(currentIndex-1+slidesData.length)%slidesData.length;
  updateTransform();
}
function updateTransform(){
  slidesContainer.style.transform=`translateY(${-currentIndex*100}%)`;
  updateCounter();
}
function updateCounter(){
  document.getElementById("slideCounter").value=currentIndex+1;
}

// --- Buscar slide por número ---
document.getElementById("slideCounter").addEventListener("change",e=>{
  let val=parseInt(e.target.value)-1;
  if(val>=0 && val<slidesData.length){currentIndex=val;updateTransform();}
});

// --- SW ---
if('serviceWorker' in navigator) navigator.serviceWorker.register('service-worker.js');
</script>
</body>
</html>