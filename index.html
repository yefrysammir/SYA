<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>SYA</title>

<link rel="manifest" href="manifest.json"/>
<meta id="themeColor" name="theme-color" content="#000000"/>

<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500&family=Cormorant+Garamond:wght@400;500&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@300" rel="stylesheet"/>

<style>
:root {
  --primary: #ffa0e5;
  --text: #ffffff;
}

/* ---------- Global ---------- */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-user-select: none;
  user-select: none;
}

html, body {
  height: 100dvh;
  width: 100%;
  overflow: hidden;
  font-family: 'Cormorant Garamond', serif;
  color: var(--text);
  overscroll-behavior: none;
  transition: background .4s;
  /* touch-action global */
  touch-action: none;
}

/* ---------- Excepciones para inputs y botones ---------- */
input, button, textarea, select {
  user-select: text !important;
  -webkit-user-select: text !important;
  touch-action: auto !important;
  pointer-events: auto !important;
  outline: none;
}

/* ---------- LOCK Overlay ---------- */
#lockOverlay {
  position: fixed;
  inset: 0;
  z-index: 99;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  transition: opacity .45s;
}

#lockOverlay.fadeOut {
  opacity: 0;
}

#lockOverlay .heart {
  font-size: 3.2rem;
  margin-bottom: .6rem;
  animation: fadeIn .8s forwards, heartbeat 1.8s infinite;
}

#lockOverlay h2 {
  font-family: 'Dancing Script', cursive;
  font-size: 2.2rem;
  animation: fadeIn .8s forwards;
}

#lockOverlay input {
  margin-top: .5rem;
  padding: .45rem .7rem;
  border-radius: 14px;
  text-align: center;
  font-size: 1rem;
  font-family: 'Cormorant Garamond', serif;
  border: none;
  background: #ffffff10; /* opcional para visibilidad */
}

#lockOverlay input::placeholder {
  color: #ddd;
  font-family: 'Cormorant Garamond', serif;
}

#lockOverlay button {
  margin-top: .6rem;
  padding: .45rem 1rem;
  background: #00000015;
  backdrop-filter: blur(10px);
  color: #fff;
  border-radius: 14px;
  cursor: pointer;
  font-family: 'Cormorant Garamond', serif;
  font-size: 1rem;
}

/* ---------- Animaciones ---------- */
@keyframes fadeIn { to { opacity: 1; } }
@keyframes heartbeat { 0%,100% { transform: scale(1); } 50% { transform: scale(1.15); } }

/*------------- Slides -------------*/
#slider{position:absolute;inset:0;width:100%;height:100%}
.slide{position:absolute;inset:0;opacity:0;transition:opacity .6s;}
.slide.active{opacity:1;z-index:1}
.slide .content{height:100%;display:flex;flex-direction:column}
.topHalf{height:50%;display:flex;justify-content:center;align-items:flex-end}
.bottomHalf{height:50%;display:flex;flex-direction:column;justify-content:flex-start;align-items:center;text-align:center;padding:0 1rem}

.polaroid {
  max-width: 65%;
  border: 12px solid #fff;
  border-bottom-width: 22px;
  box-shadow: 0 14px 18px -8px rgba(0,0,0,.35);
  pointer-events: none;
  /* Añade estas propiedades para la animación */
  animation: float 6s ease-in-out infinite;
  transform-origin: center;
}

@keyframes float {
  0%, 100% { 
    transform: translateY(0) rotate(0deg); 
  }
  50% { 
    transform: translateY(-10px) rotate(1deg); 
  }
}

.bottomHalf h3{font-family:'Dancing Script',cursive;font-size:2rem;margin-top:.5rem}
.bottomHalf .date{opacity:.85;margin-top:.2rem;text-transform:capitalize}

/*------------- Nueva TopBar (frosted + transición) -------------*/
.topBar{
  position:fixed;top:.75rem;left:50%;transform:translateX(-50%);
  display:flex;align-items:center;
  background:rgba(0,0,0,.15);
  backdrop-filter:blur(10px);
  padding:.45rem 1.1rem;
  border-radius:14px;
  transition:width .3s ease,padding .3s ease;
  overflow:hidden;
  z-index:40;
}
.topBar.active{padding:.45rem 1.1rem;} /* se utiliza cuando aparece el input */

#searchBtn{cursor:pointer;font-size:1.4rem}
#searchInput{
  background:transparent;
  border:none;
  color:#fff;
  font-size:1rem;
  margin-left:.5rem;
  width:0;
  opacity:0;
  transition:width .35s ease,opacity .35s ease;
}
#searchInput.show{width:20px;opacity:1;margin-right: .5rem;border:none;outline:none;background: #00000011}

.badge {
  background: var(--primary);
  padding: 0.2rem 0.7rem;
  border-radius: 12px;
  font-size: 0.75rem;
  display: none;
  margin-left: 0.4rem;
  animation: badgeShake 0.5s;
}

/*------------- Flechas -------------*/
.edge{position:absolute;top:0;width:50%;height:100%;z-index:10}
#leftEdge{left:0;} #rightEdge{right:0;}
.nav-btn{position:absolute;top:50%;transform:translateY(-50%);font-family:'Material Symbols Outlined';font-size:3rem;color:#fff;opacity:.15;pointer-events:none}
#leftArrow{left:1rem;}#rightArrow{right:1rem;}

@keyframes badgeShake{0%,100%{transform:translateX(0)}25%{transform:translateX(-4px)}50%{transform:translateX(4px)}75%{transform:translateX(-4px)}}
</style>
</head>

<body oncontextmenu="return false;">

<div id="lockOverlay">
  <span class="material-symbols-outlined heart">partner_heart</span>
  <h2>SyA</h2>
  <input id="pwInput" type="password" placeholder="Inserte la contraseña">
  <button onclick="unlock()">Entrar</button>
  <div id="errorText" style="display:none;color:#ff8585;margin-top:.4rem">Contraseña incorrecta</div>
</div>

<div id="slider">
  <div class="slide" data-title="Momento 1" data-desc="Descripción" data-date="2025-08-12"></div>
  <div class="slide" data-title="Momento 2" data-desc="Descripción" data-date="2025-08-13"></div>
  <div class="slide" data-title="Momento 3" data-desc="Descripción" data-date="2025-08-14"></div>
  <div class="slide" data-title="Momento 4" data-desc="Descripción" data-date="2025-08-15"></div>
  <div class="slide" data-title="Momento 5" data-desc="Descripción" data-date="2025-08-16"></div>
  <div class="slide" data-title="Momento 6" data-desc="Descripción" data-date="2025-08-17"></div>
<div class="slide" data-title="Momento 7" data-desc="Descripción" data-date="2025-08-17"></div>
<div class="slide" data-title="Momento 8" data-desc="Descripción" data-date="2025-08-17"></div>
<div class="slide" data-title="Momento 9" data-desc="Descripción" data-date="2025-08-17"></div>
<div class="slide" data-title="Momento 10" data-desc="Descripción" data-date="2025-08-17"></div>
<div class="slide" data-title="Momento 11" data-desc="Descripción" data-date="2025-08-17"></div>
<div class="slide" data-title="Momento 12" data-desc="Descripción" data-date="2025-08-17"></div>
</div>

<!-- nueva topbar -->
<div class="topBar" id="topBar">
  <span id="searchBtn" class="material-symbols-outlined">search</span>
  <input id="searchInput" type="number" inputmode="numeric" min="1">
  <span id="counter"></span>
  <span id="newBadge" class="badge">Nuevo</span>
</div>

<div id="leftEdge" class="edge"></div>
<div id="rightEdge" class="edge"></div>
<div id="leftArrow" class="nav-btn">chevron_left</div>
<div id="rightArrow" class="nav-btn">chevron_right</div>

<script>
let lockEnabled=false;
const theme=document.getElementById('themeColor');

// Función para hashear con SHA-256
async function hashPassword(password) {
  const encoder = new TextEncoder();
  const data = encoder.encode(password);
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

// slides y fondos
const slides = document.querySelectorAll('.slide'),
      counter = document.getElementById('counter'),
      searchBtn = document.getElementById('searchBtn'),
      searchIn = document.getElementById('searchInput'),
      topBar = document.getElementById('topBar');

const months = ["enero", "febrero", "marzo", "abril", "mayo", "junio", "julio", "agosto", "septiembre", "octubre", "noviembre", "diciembre"];
const bgColors = [];
let hue = Math.floor(Math.random() * 360),
    step = 360 / slides.length;

for (let i = 0; i < slides.length; i++) {
  const base = `hsl(${hue},65%,86%)`,
        dark = `hsl(${hue},65%,78%)`;
  bgColors.push(`linear-gradient(${base},${dark})`);
  hue = (hue + step) % 360;
}

// Fondo inicial y theme-color
document.documentElement.style.background = bgColors[0];
const solidColor0 = bgColors[0].match(/hsl\(\d+,\d+%,\d+%\)/)[0]; // color sólido del gradiente
theme.setAttribute('content', solidColor0);
document.getElementById('lockOverlay').style.background = bgColors[0];

// contenido slides
slides.forEach((s, i) => {
  s.style.background = bgColors[i];
  const d = new Date(s.dataset.date);
  const div = document.createElement('div');
  div.className = 'content';
  div.innerHTML = `<div class="topHalf"><img src="momentos/foto${i+1}.jpg" onerror="this.src='momentos/foto0.jpg'" class="polaroid"></div><div class="bottomHalf"><h3>${s.dataset.title}</h3><div class="date">${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}</div><p>${s.dataset.desc}</p></div>`;
  s.appendChild(div);
});

let current = 0;
slides[current].classList.add('active');
counter.textContent = `1 / ${slides.length}`;

// Unlock con contraseña cifrada
async function unlock() {
  const input = document.getElementById('pwInput').value;
  const hashedInput = await hashPassword(input);

  if (hashedInput !== "0c65c03acbe8814cd741385a8745fb0b26306d8a8a709f1e2752bf0224e5dc9e") {
    document.getElementById('errorText').style.display = 'block';
    return;
  }

  const o = document.getElementById('lockOverlay');
  o.querySelector('.heart').style.animation = "none";
  o.classList.add('fadeOut');
  setTimeout(() => {
    o.remove();
    lockEnabled = true;
    showBadge();
  }, 400);
}

// Activar con tecla Enter
document.getElementById('pwInput').addEventListener('keypress', async function(e) {
  if (e.key === 'Enter') {
    await unlock();
  }
});

// slide nav
function changeSlide(d) {
  if (!lockEnabled) return;
  slides[current].classList.remove('active');
  current = (current + d + slides.length) % slides.length;
  slides[current].classList.add('active');

  // Cambiar el fondo de la página
  document.documentElement.style.background = bgColors[current];

  // Cambiar theme-color usando color sólido del gradiente
  const solidColor = bgColors[current].match(/hsl\(\d+,\d+%,\d+%\)/)[0];
  theme.setAttribute('content', solidColor);

  counter.textContent = (current + 1) + ' / ' + slides.length;
}

leftEdge.onclick = () => changeSlide(-1);
rightEdge.onclick = () => changeSlide(1);

let sx = 0;
window.addEventListener('touchstart', e => { sx = e.touches[0].clientX; });
window.addEventListener('touchend', e => {
  if (!lockEnabled) return;
  if (sx - e.changedTouches[0].clientX > 50) changeSlide(1);
  if (e.changedTouches[0].clientX - sx > 50) changeSlide(-1);
});

// Buscador
searchBtn.onclick = e => {
  if (!lockEnabled) return;
  e.stopPropagation();
  topBar.classList.add('active');
  searchIn.classList.add('show');
  searchIn.focus();
};

searchIn.addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    const n = parseInt(this.value);
    if (n >= 1 && n <= slides.length) {
      if (!lockEnabled) return;
      slides[current].classList.remove('active');
      current = n - 1;
      slides[current].classList.add('active');

      document.documentElement.style.background = bgColors[current];
      const solidColor = bgColors[current].match(/hsl\(\d+,\d+%,\d+%\)/)[0];
      theme.setAttribute('content', solidColor);

      counter.textContent = (current + 1) + ' / ' + slides.length;
      resetSearch();
    }
  }
});

searchIn.onchange = () => {
  const n = parseInt(searchIn.value);
  if (n >= 1 && n <= slides.length) changeSlide((n - 1) - current);
  resetSearch();
};

function resetSearch() {
  searchIn.classList.remove('show');
  searchIn.value = '';
  setTimeout(() => topBar.classList.remove('active'), 300);
}

window.addEventListener('click', (e) => {
  if (e.target !== searchBtn && e.target !== searchIn && searchIn.classList.contains('show')) resetSearch();
});

// badge
function showBadge() {
  const b = document.getElementById('newBadge');
  const slidesSeen = parseInt(localStorage.getItem('slidesSeen') || '0');

  if (slides.length > slidesSeen) {
    b.style.display = 'inline-block';
    setTimeout(() => {
      b.style.animation = "badgeShake 0.5s";
      setTimeout(() => {
        b.style.animation = "";
        const hideOnClick = function() {
          b.style.display = 'none';
          localStorage.setItem('slidesSeen', slides.length);
          document.removeEventListener('click', hideOnClick);
        };
        document.addEventListener('click', hideOnClick, { once: true });
      }, 500);
    }, 3000);
  }
}

if ('serviceWorker' in navigator) navigator.serviceWorker.register('service-worker.js');
</script>
</body>
</html>